# Find full documentation here https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions
name: CI

on:
  pull_request:

  # Manual invocation.
  workflow_dispatch:

  push:
    branches:
      - main
jobs:
  CI:
    runs-on: ubuntu-latest

    # See https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token
    permissions:
      # required by aws-actions/configure-aws-credentials
      id-token: write
      contents: read
    steps:

      - name: get credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          role-to-assume: ${{ secrets.GU_RIFF_RAFF_CHECKSUM_ROLE_ARN }}
          aws-region: eu-west-1

      - name: list repo contents
        run: aws s3 ls s3://riffraff-artifact/security::snyk-tag-monitor/94
        shell: bash

      - name: Compare checksums
        uses: guardian/riff-raff-checksum@nt/fix-checkout
        with:
          projectName: security::snyk-tag-monitor
          teamCityMainBuildNumber: 93
          currentBuildNumber: 94
